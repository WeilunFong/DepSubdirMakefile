###########################################################################
# Copyright (c) 2019 ZHISHAN-IoT
# 
# file    : makefile
# author  : Weilun Fong
# brief   : makefile for directory dep
# encoding: utf-8
# note    : show how to compile sub-directories which exist dependency
###########################################################################

###########################################################
##### [1] INIT WORKS
###########################################################
### shell
SHELL        := /bin/bash
CD           ?= cd
ECHO         ?= echo
###########################################################
# cover Linux Shell environment varibale "PWD"
PWD          := pwd
###########################################################
### path
PATH_ROOT    ?= $(shell $(CD) $(CURDIR)/../.. && $(PWD))
PATH_CODE    ?= $(PATH_ROOT)/code
PATH_OBJ     ?= $(PATH_ROOT)/obj

###########################################################
##### [2] GENERATE TARGET
###########################################################
CUR_DIR_TAR  := $(notdir $(CURDIR))
TAGET_LIB    := $(PATH_OBJ)/lib$(CUR_DIR_TAR).so
###########################################################
CFLAGS       += -shared -fPIC -o $(TAGET_LIB)
###########################################################

###########################################################
##### [3] START TO COMPILE
###########################################################
$(CUR_DIR_TAR): $(TAGET_LIB)
###########################################################
$(TAGET_LIB): $(CURDIR)/src/$(CUR_DIR_TAR).c
	@$(ECHO) "CC  $<"
	@$(CC) $< $(CFLAGS)
###########################################################

###########################################################
##### [+] PHONY TARGET
###########################################################
### clean
.PHONY: clean
clean:
	$(RM) $(TAGET_LIB)
